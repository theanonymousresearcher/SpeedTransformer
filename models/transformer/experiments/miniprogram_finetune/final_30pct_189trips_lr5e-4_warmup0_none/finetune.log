2025-09-13 22:28:37,378 - INFO - Initializing DataProcessor for fine-tuning...
Extracting unique trajectory IDs...
Reading traj_ids: 0it [00:00, ?it/s]Reading traj_ids: 1it [00:00, 13.09it/s]
Total unique traj_ids found: 629
Splitting traj_ids into train, validation, and test sets...
Train: 189, Val: 125, Test: 315
Fitting label encoder on target column...
Reading labels for encoding: 0it [00:00, ?it/s]Reading labels for encoding: 1it [00:00, 15.82it/s]
Classes found: ['bike' 'bus' 'car' 'train' 'walk']
Fitting scaler on training features...
Reading training features for scaling: 0it [00:00, ?it/s]Reading training features for scaling: 1it [00:00, 11.85it/s]
Scaler fitting completed.
Creating sequences in sliding windows...
Processing chunks: 0it [00:00, ?it/s]Processing chunks: 1it [00:00,  1.96it/s]Processing chunks: 1it [00:00,  1.96it/s]
Train: 587, Val: 248, Test: 904
Skipped sequences (zero length): 0
Creating sequences in sliding windows...
Processing chunks: 0it [00:00, ?it/s]Processing chunks: 1it [00:00,  2.94it/s]Processing chunks: 1it [00:00,  2.93it/s]Train: 587, Val: 248, Test: 904
Skipped sequences (zero length): 0
2025-09-13 22:28:41,090 - INFO - Loading pretrained model from: /data/A-SpeedTransformer/models/transformer/experiments/mobis_transformer_sweeps/mobis_lr1e-4_bs512_h8_d128_kv4_do0.1/mobis_lr1e-4_bs512_h8_d128_kv4_do0.1/best_model.pth
2025-09-13 22:28:41,110 - INFO - [Epoch 1/50]

/data/A-SpeedTransformer/models/transformer/model_utils.py:231: FutureWarning: `torch.cuda.amp.GradScaler(args...)` is deprecated. Please use `torch.amp.GradScaler('cuda', args...)` instead.
  self.scaler = torch.cuda.amp.GradScaler() if (use_amp and torch.cuda.is_available()) else None
/data/A-SpeedTransformer/models/transformer/model_utils.py:361: FutureWarning: You are using `torch.load` with `weights_only=False` (the current default value), which uses the default pickle module implicitly. It is possible to construct malicious pickle data which will execute arbitrary code during unpickling (See https://github.com/pytorch/pytorch/blob/main/SECURITY.md#untrusted-models for more details). In a future release, the default value for `weights_only` will be flipped to `True`. This limits the functions that could be executed during unpickling. Arbitrary objects will no longer be allowed to be loaded via this mode unless they are explicitly allowlisted by the user via `torch.serialization.add_safe_globals`. We recommend you start setting `weights_only=True` for any use case where you don't have full control of the loaded file. Please open an issue on GitHub for any issues related to this experimental feature.
  state = torch.load(path, map_location=self.device)
/data/A-SpeedTransformer/models/transformer/model_utils.py:289: FutureWarning: `torch.cuda.amp.autocast(args...)` is deprecated. Please use `torch.amp.autocast('cuda', args...)` instead.
  with torch.cuda.amp.autocast():
2025-09-13 22:28:41,982 - INFO - Train Loss: 1.1441, Train Acc: 0.6491
2025-09-13 22:28:41,983 - INFO - Val   Loss: 1.1017, Val   Acc: 0.7137
2025-09-13 22:28:42,011 - INFO -   -> Best fine-tuned model saved.
2025-09-13 22:28:42,011 - INFO - [Epoch 2/50]
/data/A-SpeedTransformer/models/transformer/model_utils.py:326: FutureWarning: `torch.cuda.amp.autocast(args...)` is deprecated. Please use `torch.amp.autocast('cuda', args...)` instead.
  with torch.cuda.amp.autocast(enabled=self.scaler is not None):
2025-09-13 22:28:42,562 - INFO - Train Loss: 0.7803, Train Acc: 0.8075
2025-09-13 22:28:42,562 - INFO - Val   Loss: 3.2277, Val   Acc: 0.4798
2025-09-13 22:28:42,562 - INFO -   -> No improvement (1/10)
2025-09-13 22:28:42,562 - INFO - [Epoch 3/50]
2025-09-13 22:28:43,065 - INFO - Train Loss: 1.5009, Train Acc: 0.6184
2025-09-13 22:28:43,066 - INFO - Val   Loss: 3.2277, Val   Acc: 0.4798
2025-09-13 22:28:43,068 - INFO -   -> No improvement (2/10)
2025-09-13 22:28:43,068 - INFO - [Epoch 4/50]
2025-09-13 22:28:43,612 - INFO - Train Loss: 1.4358, Train Acc: 0.6133
2025-09-13 22:28:43,612 - INFO - Val   Loss: 3.2277, Val   Acc: 0.4798
2025-09-13 22:28:43,614 - INFO -   -> No improvement (3/10)
2025-09-13 22:28:43,614 - INFO - [Epoch 5/50]
2025-09-13 22:28:44,152 - INFO - Train Loss: 1.2692, Train Acc: 0.6644
2025-09-13 22:28:44,153 - INFO - Val   Loss: 0.8655, Val   Acc: 0.7540
2025-09-13 22:28:44,185 - INFO -   -> Best fine-tuned model saved.
2025-09-13 22:28:44,186 - INFO - [Epoch 6/50]
2025-09-13 22:28:44,742 - INFO - Train Loss: 0.6962, Train Acc: 0.7939
2025-09-13 22:28:44,743 - INFO - Val   Loss: 0.7575, Val   Acc: 0.7823
2025-09-13 22:28:44,774 - INFO -   -> Best fine-tuned model saved.
2025-09-13 22:28:44,775 - INFO - [Epoch 7/50]
2025-09-13 22:28:45,364 - INFO - Train Loss: 0.5138, Train Acc: 0.8313
2025-09-13 22:28:45,365 - INFO - Val   Loss: 0.7309, Val   Acc: 0.7742
2025-09-13 22:28:45,366 - INFO -   -> No improvement (1/10)
2025-09-13 22:28:45,367 - INFO - [Epoch 8/50]
2025-09-13 22:28:45,914 - INFO - Train Loss: 0.4590, Train Acc: 0.8467
2025-09-13 22:28:45,914 - INFO - Val   Loss: 0.6084, Val   Acc: 0.7863
2025-09-13 22:28:45,978 - INFO -   -> Best fine-tuned model saved.
2025-09-13 22:28:45,978 - INFO - [Epoch 9/50]
2025-09-13 22:28:46,500 - INFO - Train Loss: 0.4063, Train Acc: 0.8569
2025-09-13 22:28:46,500 - INFO - Val   Loss: 0.5733, Val   Acc: 0.7944
2025-09-13 22:28:46,529 - INFO -   -> Best fine-tuned model saved.
2025-09-13 22:28:46,529 - INFO - [Epoch 10/50]
2025-09-13 22:28:47,075 - INFO - Train Loss: 0.3547, Train Acc: 0.8756
2025-09-13 22:28:47,075 - INFO - Val   Loss: 0.5798, Val   Acc: 0.7903
2025-09-13 22:28:47,077 - INFO -   -> No improvement (1/10)
2025-09-13 22:28:47,077 - INFO - [Epoch 11/50]
2025-09-13 22:28:47,580 - INFO - Train Loss: 0.3408, Train Acc: 0.8790
2025-09-13 22:28:47,581 - INFO - Val   Loss: 0.6445, Val   Acc: 0.7782
2025-09-13 22:28:47,582 - INFO -   -> No improvement (2/10)
2025-09-13 22:28:47,583 - INFO - [Epoch 12/50]
2025-09-13 22:28:48,094 - INFO - Train Loss: 0.3327, Train Acc: 0.8722
2025-09-13 22:28:48,095 - INFO - Val   Loss: 0.5492, Val   Acc: 0.8065
2025-09-13 22:28:48,122 - INFO -   -> Best fine-tuned model saved.
2025-09-13 22:28:48,123 - INFO - [Epoch 13/50]
2025-09-13 22:28:48,655 - INFO - Train Loss: 0.3168, Train Acc: 0.8944
2025-09-13 22:28:48,655 - INFO - Val   Loss: 0.5542, Val   Acc: 0.7984
2025-09-13 22:28:48,657 - INFO -   -> No improvement (1/10)
2025-09-13 22:28:48,658 - INFO - [Epoch 14/50]
2025-09-13 22:28:49,202 - INFO - Train Loss: 0.2939, Train Acc: 0.8961
2025-09-13 22:28:49,203 - INFO - Val   Loss: 0.6077, Val   Acc: 0.7984
2025-09-13 22:28:49,204 - INFO -   -> No improvement (2/10)
2025-09-13 22:28:49,205 - INFO - [Epoch 15/50]
2025-09-13 22:28:49,753 - INFO - Train Loss: 0.2767, Train Acc: 0.8927
2025-09-13 22:28:49,753 - INFO - Val   Loss: 0.5122, Val   Acc: 0.8427
2025-09-13 22:28:49,784 - INFO -   -> Best fine-tuned model saved.
2025-09-13 22:28:49,785 - INFO - [Epoch 16/50]
2025-09-13 22:28:50,355 - INFO - Train Loss: 0.2561, Train Acc: 0.9012
2025-09-13 22:28:50,355 - INFO - Val   Loss: 0.5066, Val   Acc: 0.8226
2025-09-13 22:28:50,357 - INFO -   -> No improvement (1/10)
2025-09-13 22:28:50,358 - INFO - [Epoch 17/50]
2025-09-13 22:28:50,910 - INFO - Train Loss: 0.2513, Train Acc: 0.9029
2025-09-13 22:28:50,910 - INFO - Val   Loss: 0.6204, Val   Acc: 0.8145
2025-09-13 22:28:50,912 - INFO -   -> No improvement (2/10)
2025-09-13 22:28:50,913 - INFO - [Epoch 18/50]
2025-09-13 22:28:51,432 - INFO - Train Loss: 0.2328, Train Acc: 0.9080
2025-09-13 22:28:51,432 - INFO - Val   Loss: 0.4443, Val   Acc: 0.8669
2025-09-13 22:28:51,461 - INFO -   -> Best fine-tuned model saved.
2025-09-13 22:28:51,462 - INFO - [Epoch 19/50]
2025-09-13 22:28:52,013 - INFO - Train Loss: 0.2213, Train Acc: 0.9097
2025-09-13 22:28:52,014 - INFO - Val   Loss: 0.4534, Val   Acc: 0.8065
2025-09-13 22:28:52,016 - INFO -   -> No improvement (1/10)
2025-09-13 22:28:52,016 - INFO - [Epoch 20/50]
2025-09-13 22:28:52,597 - INFO - Train Loss: 0.2224, Train Acc: 0.9404
2025-09-13 22:28:52,598 - INFO - Val   Loss: 0.3873, Val   Acc: 0.8669
2025-09-13 22:28:52,600 - INFO -   -> No improvement (2/10)
2025-09-13 22:28:52,601 - INFO - [Epoch 21/50]
2025-09-13 22:28:53,214 - INFO - Train Loss: 0.1790, Train Acc: 0.9336
2025-09-13 22:28:53,214 - INFO - Val   Loss: 0.4992, Val   Acc: 0.8831
2025-09-13 22:28:53,247 - INFO -   -> Best fine-tuned model saved.
2025-09-13 22:28:53,248 - INFO - [Epoch 22/50]
2025-09-13 22:28:53,876 - INFO - Train Loss: 0.1857, Train Acc: 0.9267
2025-09-13 22:28:53,877 - INFO - Val   Loss: 0.8275, Val   Acc: 0.8024
2025-09-13 22:28:53,879 - INFO -   -> No improvement (1/10)
2025-09-13 22:28:53,879 - INFO - [Epoch 23/50]
2025-09-13 22:28:54,446 - INFO - Train Loss: 0.2811, Train Acc: 0.8842
2025-09-13 22:28:54,446 - INFO - Val   Loss: 0.5304, Val   Acc: 0.8468
2025-09-13 22:28:54,448 - INFO -   -> No improvement (2/10)
2025-09-13 22:28:54,448 - INFO - [Epoch 24/50]
2025-09-13 22:28:55,007 - INFO - Train Loss: 0.1564, Train Acc: 0.9489
2025-09-13 22:28:55,008 - INFO - Val   Loss: 0.6570, Val   Acc: 0.8710
2025-09-13 22:28:55,008 - INFO -   -> No improvement (3/10)
2025-09-13 22:28:55,008 - INFO - [Epoch 25/50]
2025-09-13 22:28:55,558 - INFO - Train Loss: 0.2715, Train Acc: 0.9029
2025-09-13 22:28:55,559 - INFO - Val   Loss: 0.5331, Val   Acc: 0.8105
2025-09-13 22:28:55,561 - INFO -   -> No improvement (4/10)
2025-09-13 22:28:55,562 - INFO - [Epoch 26/50]
2025-09-13 22:28:56,136 - INFO - Train Loss: 0.1844, Train Acc: 0.9250
2025-09-13 22:28:56,137 - INFO - Val   Loss: 0.4985, Val   Acc: 0.8145
2025-09-13 22:28:56,139 - INFO -   -> No improvement (5/10)
2025-09-13 22:28:56,139 - INFO - [Epoch 27/50]
2025-09-13 22:28:56,728 - INFO - Train Loss: 0.1760, Train Acc: 0.9387
2025-09-13 22:28:56,728 - INFO - Val   Loss: 0.4766, Val   Acc: 0.8669
2025-09-13 22:28:56,730 - INFO -   -> No improvement (6/10)
2025-09-13 22:28:56,730 - INFO - [Epoch 28/50]
2025-09-13 22:28:57,300 - INFO - Train Loss: 0.1446, Train Acc: 0.9370
2025-09-13 22:28:57,301 - INFO - Val   Loss: 0.5965, Val   Acc: 0.8306
2025-09-13 22:28:57,303 - INFO -   -> No improvement (7/10)
2025-09-13 22:28:57,303 - INFO - [Epoch 29/50]
2025-09-13 22:28:57,928 - INFO - Train Loss: 0.1609, Train Acc: 0.9540
2025-09-13 22:28:57,928 - INFO - Val   Loss: 0.4924, Val   Acc: 0.8750
2025-09-13 22:28:57,930 - INFO -   -> No improvement (8/10)
2025-09-13 22:28:57,930 - INFO - [Epoch 30/50]
2025-09-13 22:28:58,545 - INFO - Train Loss: 0.1338, Train Acc: 0.9506
2025-09-13 22:28:58,546 - INFO - Val   Loss: 0.4797, Val   Acc: 0.8911
2025-09-13 22:28:58,583 - INFO -   -> Best fine-tuned model saved.
2025-09-13 22:28:58,584 - INFO - [Epoch 31/50]
2025-09-13 22:28:59,137 - INFO - Train Loss: 0.1154, Train Acc: 0.9625
2025-09-13 22:28:59,137 - INFO - Val   Loss: 0.4939, Val   Acc: 0.8952
2025-09-13 22:28:59,180 - INFO -   -> Best fine-tuned model saved.
2025-09-13 22:28:59,181 - INFO - [Epoch 32/50]
2025-09-13 22:28:59,732 - INFO - Train Loss: 0.0955, Train Acc: 0.9693
2025-09-13 22:28:59,732 - INFO - Val   Loss: 0.5341, Val   Acc: 0.8871
2025-09-13 22:28:59,734 - INFO -   -> No improvement (1/10)
2025-09-13 22:28:59,735 - INFO - [Epoch 33/50]
2025-09-13 22:29:00,272 - INFO - Train Loss: 0.1001, Train Acc: 0.9608
2025-09-13 22:29:00,273 - INFO - Val   Loss: 0.8676, Val   Acc: 0.8105
2025-09-13 22:29:00,275 - INFO -   -> No improvement (2/10)
2025-09-13 22:29:00,275 - INFO - [Epoch 34/50]
2025-09-13 22:29:00,940 - INFO - Train Loss: 0.2035, Train Acc: 0.9097
2025-09-13 22:29:00,941 - INFO - Val   Loss: 0.5024, Val   Acc: 0.8831
2025-09-13 22:29:00,943 - INFO -   -> No improvement (3/10)
2025-09-13 22:29:00,943 - INFO - [Epoch 35/50]
2025-09-13 22:29:01,563 - INFO - Train Loss: 0.1153, Train Acc: 0.9506
2025-09-13 22:29:01,564 - INFO - Val   Loss: 0.8564, Val   Acc: 0.8185
2025-09-13 22:29:01,566 - INFO -   -> No improvement (4/10)
2025-09-13 22:29:01,566 - INFO - [Epoch 36/50]
2025-09-13 22:29:02,113 - INFO - Train Loss: 0.1196, Train Acc: 0.9540
2025-09-13 22:29:02,114 - INFO - Val   Loss: 0.5718, Val   Acc: 0.8992
2025-09-13 22:29:02,147 - INFO -   -> Best fine-tuned model saved.
2025-09-13 22:29:02,147 - INFO - [Epoch 37/50]
2025-09-13 22:29:02,703 - INFO - Train Loss: 0.0886, Train Acc: 0.9659
2025-09-13 22:29:02,703 - INFO - Val   Loss: 0.5473, Val   Acc: 0.9032
2025-09-13 22:29:02,730 - INFO -   -> Best fine-tuned model saved.
2025-09-13 22:29:02,731 - INFO - [Epoch 38/50]
2025-09-13 22:29:03,324 - INFO - Train Loss: 0.0790, Train Acc: 0.9744
2025-09-13 22:29:03,325 - INFO - Val   Loss: 0.6427, Val   Acc: 0.8750
2025-09-13 22:29:03,327 - INFO -   -> No improvement (1/10)
2025-09-13 22:29:03,327 - INFO - [Epoch 39/50]
2025-09-13 22:29:03,973 - INFO - Train Loss: 0.0758, Train Acc: 0.9727
2025-09-13 22:29:03,973 - INFO - Val   Loss: 0.6532, Val   Acc: 0.8750
2025-09-13 22:29:03,977 - INFO -   -> No improvement (2/10)
2025-09-13 22:29:03,977 - INFO - [Epoch 40/50]
2025-09-13 22:29:04,624 - INFO - Train Loss: 0.1245, Train Acc: 0.9523
2025-09-13 22:29:04,625 - INFO - Val   Loss: 1.0960, Val   Acc: 0.8105
2025-09-13 22:29:04,625 - INFO -   -> No improvement (3/10)
2025-09-13 22:29:04,628 - INFO - [Epoch 41/50]
2025-09-13 22:29:05,237 - INFO - Train Loss: 0.4082, Train Acc: 0.8348
2025-09-13 22:29:05,238 - INFO - Val   Loss: 0.5607, Val   Acc: 0.8669
2025-09-13 22:29:05,240 - INFO -   -> No improvement (4/10)
2025-09-13 22:29:05,240 - INFO - [Epoch 42/50]
2025-09-13 22:29:05,793 - INFO - Train Loss: 0.0773, Train Acc: 0.9710
2025-09-13 22:29:05,794 - INFO - Val   Loss: 0.8934, Val   Acc: 0.8468
2025-09-13 22:29:05,794 - INFO -   -> No improvement (5/10)
2025-09-13 22:29:05,794 - INFO - [Epoch 43/50]
2025-09-13 22:29:06,458 - INFO - Train Loss: 0.3303, Train Acc: 0.9302
2025-09-13 22:29:06,459 - INFO - Val   Loss: 0.9399, Val   Acc: 0.8347
2025-09-13 22:29:06,461 - INFO -   -> No improvement (6/10)
2025-09-13 22:29:06,462 - INFO - [Epoch 44/50]
2025-09-13 22:29:07,034 - INFO - Train Loss: 0.1479, Train Acc: 0.9404
2025-09-13 22:29:07,035 - INFO - Val   Loss: 0.5039, Val   Acc: 0.8871
2025-09-13 22:29:07,035 - INFO -   -> No improvement (7/10)
2025-09-13 22:29:07,035 - INFO - [Epoch 45/50]
2025-09-13 22:29:07,601 - INFO - Train Loss: 0.1396, Train Acc: 0.9387
2025-09-13 22:29:07,601 - INFO - Val   Loss: 0.5488, Val   Acc: 0.8710
2025-09-13 22:29:07,602 - INFO -   -> No improvement (8/10)
2025-09-13 22:29:07,604 - INFO - [Epoch 46/50]
2025-09-13 22:29:08,200 - INFO - Train Loss: 0.1217, Train Acc: 0.9540
2025-09-13 22:29:08,200 - INFO - Val   Loss: 0.4414, Val   Acc: 0.8952
2025-09-13 22:29:08,200 - INFO -   -> No improvement (9/10)
2025-09-13 22:29:08,201 - INFO - [Epoch 47/50]
2025-09-13 22:29:08,804 - INFO - Train Loss: 0.1079, Train Acc: 0.9608
2025-09-13 22:29:08,805 - INFO - Val   Loss: 0.5548, Val   Acc: 0.8992
2025-09-13 22:29:08,807 - INFO -   -> No improvement (10/10)
2025-09-13 22:29:08,807 - INFO - Early stopping triggered.
2025-09-13 22:29:08,808 - INFO - 
Loading best fine-tuned model from /data/A-SpeedTransformer/models/transformer/experiments/miniprogram_finetune/final_30pct_189trips_lr5e-4_warmup0_none/best_model.pth for final evaluation...
2025-09-13 22:29:09,335 - INFO - Test Loss: 0.3538, Test Accuracy: 0.9115
2025-09-13 22:29:09,346 - INFO - Classification Report:
              precision    recall  f1-score   support

        bike       0.81      0.64      0.72        59
         bus       0.94      0.82      0.88       202
         car       0.89      0.97      0.93       351
       train       0.68      0.77      0.72        22
        walk       0.95      0.98      0.97       270

    accuracy                           0.91       904
   macro avg       0.86      0.84      0.84       904
weighted avg       0.91      0.91      0.91       904

2025-09-13 22:29:09,839 - INFO - Saved confusion_matrix_finetune.png
/data/A-SpeedTransformer/models/transformer/model_utils.py:349: FutureWarning: `torch.cuda.amp.autocast(args...)` is deprecated. Please use `torch.amp.autocast('cuda', args...)` instead.
  with torch.cuda.amp.autocast(enabled=self.scaler is not None):
